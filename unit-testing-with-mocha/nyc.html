<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>引入 nyc 获取代码覆盖率 | Test Automation Training</title>
    <meta name="generator" content="VuePress 1.6.0">
    <link rel="icon" href="/test-automation-training/logo.png">
    <meta name="description" content="web 自动化测试指导手册">
    <link rel="preload" href="/test-automation-training/assets/css/0.styles.ae6bd330.css" as="style"><link rel="preload" href="/test-automation-training/assets/js/app.71eef9e6.js" as="script"><link rel="preload" href="/test-automation-training/assets/js/6.83bd01bd.js" as="script"><link rel="preload" href="/test-automation-training/assets/js/3.7625da88.js" as="script"><link rel="preload" href="/test-automation-training/assets/js/16.f263b035.js" as="script"><link rel="prefetch" href="/test-automation-training/assets/js/1.2778aedf.js"><link rel="prefetch" href="/test-automation-training/assets/js/10.644e0914.js"><link rel="prefetch" href="/test-automation-training/assets/js/11.ed0b2258.js"><link rel="prefetch" href="/test-automation-training/assets/js/12.0867d637.js"><link rel="prefetch" href="/test-automation-training/assets/js/13.445d9e12.js"><link rel="prefetch" href="/test-automation-training/assets/js/14.7acbab68.js"><link rel="prefetch" href="/test-automation-training/assets/js/15.c6e103f4.js"><link rel="prefetch" href="/test-automation-training/assets/js/17.22baea5e.js"><link rel="prefetch" href="/test-automation-training/assets/js/4.ecfed516.js"><link rel="prefetch" href="/test-automation-training/assets/js/5.75fb569b.js"><link rel="prefetch" href="/test-automation-training/assets/js/7.f1ccdb57.js"><link rel="prefetch" href="/test-automation-training/assets/js/8.e39e8234.js"><link rel="prefetch" href="/test-automation-training/assets/js/9.51758630.js">
    <link rel="stylesheet" href="/test-automation-training/assets/css/0.styles.ae6bd330.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container fastest-docs-container"><header style="background-color:rgba(255, 255, 255, 1);box-shadow:0px 2px 30px 0px rgba(0, 0, 0, 0.1);" data-v-13584f65><nav data-v-13584f65><a href="/test-automation-training/" class="logo-wrapper router-link-active" data-v-13584f65><span class="name" data-v-13584f65>Test Automation Training</span></a> <ul class="navs" data-v-13584f65><li class="nav" data-v-13584f65><a href="/test-automation-training/about/" class="nav__link--white" style="color:rgba(102, 102, 102, 1);" data-v-13584f65>自动化测试理论
        </a> <!----></li><li class="nav" data-v-13584f65><a href="/test-automation-training/unit-testing-with-mocha/" class="router-link-active nav__link--active" style="color:rgba(102, 102, 102, 1);" data-v-13584f65>单元测试-Mocha
        </a> <!----></li><li class="nav" data-v-13584f65><a href="https://github.com/matmanjs/test-automation-training/issues" target="_blank" rel="noopener noreferrer" class="nav__link--white" style="color:rgba(102, 102, 102, 1);" data-v-13584f65>Issues</a> <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound" data-v-13584f65><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></li></ul></nav></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/test-automation-training/unit-testing-with-mocha/" aria-current="page" class="sidebar-link">单元测试-Mocha</a></li><li><a href="/test-automation-training/unit-testing-with-mocha/mocha.html" class="sidebar-link">Mocha 入门教程</a></li><li><a href="/test-automation-training/unit-testing-with-mocha/unit-test.html" class="sidebar-link">为项目接入单元测试</a></li><li><a href="/test-automation-training/unit-testing-with-mocha/nyc.html" aria-current="page" class="active sidebar-link">代码覆盖率</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/test-automation-training/unit-testing-with-mocha/nyc.html#_1-约定" class="sidebar-link">1. 约定</a></li><li class="sidebar-sub-header"><a href="/test-automation-training/unit-testing-with-mocha/nyc.html#_2-快速接入" class="sidebar-link">2. 快速接入</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="引入-nyc-获取代码覆盖率"><a href="#引入-nyc-获取代码覆盖率" class="header-anchor">#</a> 引入 nyc 获取代码覆盖率</h1> <p>我们使用 <a href="https://www.npmjs.com/package/nyc" target="_blank" rel="noopener noreferrer">nyc<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来获得测试覆盖率报告。</p> <h2 id="_1-约定"><a href="#_1-约定" class="header-anchor">#</a> 1. 约定</h2> <p>参考业界通用实践，我们推荐如下约定。</p> <ul><li>覆盖率产物输出到 <code>.test_output/coverage</code> 目录</li> <li>统计覆盖率时，统计所有的文件，而不仅仅是测试用例涉及的文件</li></ul> <h2 id="_2-快速接入"><a href="#_2-快速接入" class="header-anchor">#</a> 2. 快速接入</h2> <h3 id="_2-1-安装依赖"><a href="#_2-1-安装依赖" class="header-anchor">#</a> 2.1 安装依赖</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> i nyc --save-dev
</code></pre></div><h3 id="_2-2-增加-nycrc-文件"><a href="#_2-2-增加-nycrc-文件" class="header-anchor">#</a> 2.2 增加 .nycrc 文件</h3> <p>在项目根目录下新创建 <code>.nycrc</code> 文件，如下。配置参数详见： https://www.npmjs.com/package/nyc#configuration-files 。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;all&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;src/**/*.js&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;exclude&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;src/**/modules/**/*.js&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;src/**/assets/**/*.js&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;reporter&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
         <span class="token string">&quot;text-summary&quot;</span><span class="token punctuation">,</span>
         <span class="token string">&quot;html&quot;</span><span class="token punctuation">,</span>
         <span class="token string">&quot;lcovonly&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;report-dir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.test_output/coverage&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意：</p> <ul><li><code>all</code> 定义是否包含未被执行的文件，注意一定要设置为 <code>true</code>，否则计算出的覆盖率只是测试用例涉及的文件的覆盖率，不是实际的覆盖率</li> <li><code>include</code> 定义了哪些文件计算在内，你也可以按需修改</li> <li><code>exclude</code> 排除部分文件，例如第三方库等，默认情况下会排除 <code>node_modules</code> 下文件，你也可以按需修改</li> <li><code>reporter</code> 参数至少要配置如下两种，其他可选值也可以查看 <a href="https://istanbul.js.org/docs/advanced/alternative-reporters/" target="_blank" rel="noopener noreferrer">Using Alternative Reporters<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 。
<ul><li><code>text-summary</code> ：控制台日志会直接打印执行结果，方便在控制台直接查看建议覆盖率结果</li> <li><code>html</code> ：会有静态 html 页面产生，方便我们自己可视化查看结果，可以看到所有文件的代码哪些被覆盖了，哪些未被覆盖</li> <li><code>lconvonly</code> ：产生 <code>lcov.info</code> 文件，属于标准的覆盖率产物，一般是提供给第三方统计分析平台用</li></ul></li> <li><code>report-dir</code> 指定了报告的输出，推荐放在 <code>.test_output/coverage</code> 目录下</li></ul> <h3 id="_2-3-修改-package-json"><a href="#_2-3-修改-package-json" class="header-anchor">#</a> 2.3 修改 package.json</h3> <p>在 <code>package.json</code> 文件中，增加 <code>coverage</code> 的命令，则后续可以运行 <code>npm run coverage</code> 或者运行  <code>npm run test:unit</code> 获得单元测试的代码覆盖率。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;test:unit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run coverage&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;test:unit:direct&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha test/unit&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;coverage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nyc npm run test:unit:direct&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-4-查看结果"><a href="#_2-4-查看结果" class="header-anchor">#</a> 2.4 查看结果</h3> <p>运行之后，可以在控制台看到简单的覆盖率信息输出。</p> <p><img src="index_files/fe19bf08-fc22-41c2-83c9-c8a21e84f987.jpg" alt=""></p> <p>而在 <code>.test_output/coverage</code> 可以看到结果：</p> <p><img src="index_files/80c866a8-985f-4bd9-bd40-072eaaa4ff78.jpg" alt=""></p> <p>打开 <code>index.html</code> 之后，可以看到覆盖率信息，我们主要关注 <code>Lines</code> 这个值，一般我们提到单元测试代码覆盖率就是指这个值。</p> <p><img src="index_files/63839117-0610-48ba-a3f7-a95fa829bdb1.jpg" alt=""></p> <p>注意，文件是可以点击打开的，进入之后可以看到，如果有红色的代码，则说明该代码没有单元测试覆盖。</p> <p><img src="index_files/2296f534-7a8d-43fb-8177-8c830421c039.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/test-automation-training/unit-testing-with-mocha/unit-test.html" class="prev">
        为项目接入单元测试
      </a></span> <!----></p></div> </main> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/test-automation-training/assets/js/app.71eef9e6.js" defer></script><script src="/test-automation-training/assets/js/6.83bd01bd.js" defer></script><script src="/test-automation-training/assets/js/3.7625da88.js" defer></script><script src="/test-automation-training/assets/js/16.f263b035.js" defer></script>
  </body>
</html>
