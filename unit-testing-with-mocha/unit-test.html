<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>为项目接入单元测试 | Test Automation Training</title>
    <meta name="generator" content="VuePress 1.6.0">
    <link rel="icon" href="/test-automation-training/logo.png">
    <meta name="description" content="web 自动化测试指导手册">
    <link rel="preload" href="/test-automation-training/assets/css/0.styles.ae6bd330.css" as="style"><link rel="preload" href="/test-automation-training/assets/js/app.71eef9e6.js" as="script"><link rel="preload" href="/test-automation-training/assets/js/6.83bd01bd.js" as="script"><link rel="preload" href="/test-automation-training/assets/js/3.7625da88.js" as="script"><link rel="preload" href="/test-automation-training/assets/js/17.22baea5e.js" as="script"><link rel="prefetch" href="/test-automation-training/assets/js/1.2778aedf.js"><link rel="prefetch" href="/test-automation-training/assets/js/10.644e0914.js"><link rel="prefetch" href="/test-automation-training/assets/js/11.ed0b2258.js"><link rel="prefetch" href="/test-automation-training/assets/js/12.0867d637.js"><link rel="prefetch" href="/test-automation-training/assets/js/13.445d9e12.js"><link rel="prefetch" href="/test-automation-training/assets/js/14.7acbab68.js"><link rel="prefetch" href="/test-automation-training/assets/js/15.c6e103f4.js"><link rel="prefetch" href="/test-automation-training/assets/js/16.f263b035.js"><link rel="prefetch" href="/test-automation-training/assets/js/4.ecfed516.js"><link rel="prefetch" href="/test-automation-training/assets/js/5.75fb569b.js"><link rel="prefetch" href="/test-automation-training/assets/js/7.f1ccdb57.js"><link rel="prefetch" href="/test-automation-training/assets/js/8.e39e8234.js"><link rel="prefetch" href="/test-automation-training/assets/js/9.51758630.js">
    <link rel="stylesheet" href="/test-automation-training/assets/css/0.styles.ae6bd330.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container fastest-docs-container"><header style="background-color:rgba(255, 255, 255, 1);box-shadow:0px 2px 30px 0px rgba(0, 0, 0, 0.1);" data-v-13584f65><nav data-v-13584f65><a href="/test-automation-training/" class="logo-wrapper router-link-active" data-v-13584f65><span class="name" data-v-13584f65>Test Automation Training</span></a> <ul class="navs" data-v-13584f65><li class="nav" data-v-13584f65><a href="/test-automation-training/about/" class="nav__link--white" style="color:rgba(102, 102, 102, 1);" data-v-13584f65>自动化测试理论
        </a> <!----></li><li class="nav" data-v-13584f65><a href="/test-automation-training/unit-testing-with-mocha/" class="router-link-active nav__link--active" style="color:rgba(102, 102, 102, 1);" data-v-13584f65>单元测试-Mocha
        </a> <!----></li><li class="nav" data-v-13584f65><a href="https://github.com/matmanjs/test-automation-training/issues" target="_blank" rel="noopener noreferrer" class="nav__link--white" style="color:rgba(102, 102, 102, 1);" data-v-13584f65>Issues</a> <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound" data-v-13584f65><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></li></ul></nav></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/test-automation-training/unit-testing-with-mocha/" aria-current="page" class="sidebar-link">单元测试-Mocha</a></li><li><a href="/test-automation-training/unit-testing-with-mocha/mocha.html" class="sidebar-link">Mocha 入门教程</a></li><li><a href="/test-automation-training/unit-testing-with-mocha/unit-test.html" aria-current="page" class="active sidebar-link">为项目接入单元测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/test-automation-training/unit-testing-with-mocha/unit-test.html#_1-约定" class="sidebar-link">1. 约定</a></li><li class="sidebar-sub-header"><a href="/test-automation-training/unit-testing-with-mocha/unit-test.html#_2-快速接入" class="sidebar-link">2. 快速接入</a></li><li class="sidebar-sub-header"><a href="/test-automation-training/unit-testing-with-mocha/unit-test.html#_3-es6-项目接入" class="sidebar-link">3. ES6 项目接入</a></li><li class="sidebar-sub-header"><a href="/test-automation-training/unit-testing-with-mocha/unit-test.html#_4-ts-项目接入" class="sidebar-link">4. TS 项目接入</a></li><li class="sidebar-sub-header"><a href="/test-automation-training/unit-testing-with-mocha/unit-test.html#_5-常见问题" class="sidebar-link">5. 常见问题</a></li></ul></li><li><a href="/test-automation-training/unit-testing-with-mocha/nyc.html" class="sidebar-link">代码覆盖率</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="为项目接入单元测试"><a href="#为项目接入单元测试" class="header-anchor">#</a> 为项目接入单元测试</h1> <h2 id="_1-约定"><a href="#_1-约定" class="header-anchor">#</a> 1. 约定</h2> <p>参考业界通用实践，我们推荐如下约定。</p> <h3 id="_1-1-测试文件放置在-test-unit-目录"><a href="#_1-1-测试文件放置在-test-unit-目录" class="header-anchor">#</a> 1.1 测试文件放置在 <code>test/unit</code> 目录</h3> <p>对于 Mocha 而言，其默认目录为 <code>test</code>，但我们推荐单元测试的测试文件目录为 <code>test/unit</code> ，原因包括：</p> <ul><li>可能会存在一些额外的与测试相关的脚本或者资源等放在 <code>test/scripts</code> 或 <code>test/data</code> 中，可使之隔离，更容易处理</li> <li>可与端对端测试文件目录 <code>test/e2e</code> 进行区分</li></ul> <h3 id="_1-2-测试产物都输出到-test-output-目录"><a href="#_1-2-测试产物都输出到-test-output-目录" class="header-anchor">#</a> 1.2 测试产物都输出到 <code>.test_output</code> 目录</h3> <p>一般测试产物可能包括 Mocha 的测试报告（例如 <code>mochawesome</code>）和覆盖率报告(例如 <code>nyc</code>)等，将它们统一输出到一个文件夹内，方便管理，避免运行之后，在项目中无端增加过多文件夹，也方便设置 <code>.gitignore</code>。</p> <p>之所以是 <code>.test_output</code>，是因为一些开源社区组件也是这么命名的，例如 <code>.nyc_output</code>。</p> <h3 id="_1-3-测试文件命名格式使用-xxx-test-js"><a href="#_1-3-测试文件命名格式使用-xxx-test-js" class="header-anchor">#</a> 1.3 测试文件命名格式使用  <code>xxx.test.js</code></h3> <p>通常测试文件以 <code>.test.js</code> 和 <code>.spec.js</code> 结尾，我们推荐前者。</p> <h3 id="_1-4-不推荐全局安装-mocha"><a href="#_1-4-不推荐全局安装-mocha" class="header-anchor">#</a> 1.4 不推荐全局安装 mocha</h3> <p>虽然可以全局安装 <code>mocha</code>，但是我们并不推荐，这并不是必要的，原因主要是：</p> <ul><li>全局安装时，若有多个项目使用不同的 <code>mocha</code> 版本，则可能会有问题</li> <li>安装在本地，在 <code>package.json</code> 的 <code>devDependecies</code> 中引入，并适当设置 <code>scripts</code> 命令即可，或者使用 <code>npx mocha xxx</code> 也能部分情况下代替全局安装的 <code>mocha</code></li></ul> <h2 id="_2-快速接入"><a href="#_2-快速接入" class="header-anchor">#</a> 2. 快速接入</h2> <h3 id="_2-1-安装依赖"><a href="#_2-1-安装依赖" class="header-anchor">#</a> 2.1 安装依赖</h3> <p>使用 Mocha 做单元测试时，我们建议使用 <a href="https://mochajs.org/" target="_blank" rel="noopener noreferrer">mocha<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> + <a href="https://www.chaijs.com/" target="_blank" rel="noopener noreferrer">chai<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 这种组合。并且，由于 mocha 升级到 <code>v8.x</code> 版本之后做了比较大的改动，建议如果是新业务，直接升级到 <code>v8.x</code> 以上！</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> i mocha chai --save-dev
</code></pre></div><p>为了更好的查看测试结果，我们使用 <a href="https://www.npmjs.com/package/mochawesome" target="_blank" rel="noopener noreferrer">mochawesome<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>  来做测试报告输出:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> i mochawesome --save-dev
</code></pre></div><h3 id="_2-2-配置-mocha"><a href="#_2-2-配置-mocha" class="header-anchor">#</a> 2.2 配置 mocha</h3> <p>如果是 mocha <code>v8.x</code> 及以上版本，则在项目根目录下创建 <code>.mocharc.yml</code> 文件，参数说明可以参考 <a href="https://mochajs.org/#configuring-mocha-nodejs" target="_blank" rel="noopener noreferrer">CONFIGURING MOCHA (NODE.JS)<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 。</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">reporter</span><span class="token punctuation">:</span> <span class="token string">'mochawesome'</span>
<span class="token key atrule">reporterOptions</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">'reportDir=.test_output/mochawesome'</span>
<span class="token key atrule">recursive</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>如果是 mocha <code>v8.x</code> 以下版本，则在 <code>test</code> 目录下创建 <code>test /mocha.opts</code> 文件，并配置如下：</p> <blockquote><p>强烈建议升级 mocha 到 <code>v8.x</code> 及以上版本。</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>--reporter mochawesome
--reporter-options reportDir=../.test_output/mochawesome
--recursive
</code></pre></div><h3 id="_2-3-修改-package-json"><a href="#_2-3-修改-package-json" class="header-anchor">#</a> 2.3 修改 package.json</h3> <p>在 <code>package.json</code> 文件的测试命令中追加 <code>test</code> 配置 ，例如</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test:unit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha test/unit&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如此一来，就可以通过运行下面的命令执行单元测试了：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> run test:unit
</code></pre></div><h3 id="_2-4-修改-gitignore"><a href="#_2-4-修改-gitignore" class="header-anchor">#</a> 2.4 修改 .gitignore</h3> <p>由于我们将单元测试的测试产物都输出到 <code>.test_output</code> 目录下，因此需要在 <code>.gitignore</code> 文件中追加如下配置，避免提交到 git 仓库中 。</p> <div class="language- extra-class"><pre class="language-text"><code>.test_output
</code></pre></div><h3 id="_2-5-验证"><a href="#_2-5-验证" class="header-anchor">#</a> 2.5. 验证</h3> <p>新增 <code>test/unit/tmp.test.js</code>，内容下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chai'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'加法函数的测试'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'1 加 1 应该等于 2'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在项目根目录下，执行 <code>npm run test:unit</code> 命令，如果输出正常，且在 <code>.test_output</code> 目录下有输出，则说明配置已完成。</p> <p><img src="index_files/0c84c031-f10a-4f4b-8385-ba315070662e.jpg" alt=""> <img src="index_files/d15bc4a1-d6b5-4d8d-b540-ed7b10e6e73c.png" alt=""></p> <h2 id="_3-es6-项目接入"><a href="#_3-es6-项目接入" class="header-anchor">#</a> 3. ES6 项目接入</h2> <blockquote><p>可以参考 https://github.com/matmanjs/test-automation-training/tree/master/mocha/05.es6 这个例子。</p></blockquote> <p>需要引入 <a href="https://babeljs.io/" target="_blank" rel="noopener noreferrer">babel<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 及相关插件来处理，例如引入 <a href="https://www.npmjs.com/package/@babel/preset-env" target="_blank" rel="noopener noreferrer">@babel/preset-env<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> i @babel/preset-env --save-dev
</code></pre></div><p>同时为 <code>.babelrc</code> 文件增加配置：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;@babel/preset-env&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最后需要在 <code>.mocharc.yml</code> 中增加一个 <code>require</code> 的配置：</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">require</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">'@babel/preset-env'</span>
</code></pre></div><p>但有时候单元测试使用的 babel 配置与项目构建的可能不一样，例如  <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的应用，就不会直接暴露 <code>.babelrc</code> 出来，此时可以使用 <code>BABEL_ENV</code> 来处理，可以配置 <code>.babelrc</code> 为：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;@babel/preset-env&quot;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后测试命令中增加  <code>BABEL_ENV=test</code>，例如  <code>cross-env BABEL_ENV=test mocha test/unit</code> 。如果在 <code>package.json</code> 文件中，则可修改为：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test:unit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env BABEL_ENV=test mocha test/unit&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意需要安装下 <a href="https://www.npmjs.com/package/cross-env" target="_blank" rel="noopener noreferrer">cross-env<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> :</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> i cross-env --save-dev
</code></pre></div><h2 id="_4-ts-项目接入"><a href="#_4-ts-项目接入" class="header-anchor">#</a> 4. TS 项目接入</h2> <blockquote><p>可以参考 https://github.com/matmanjs/test-automation-training/tree/master/mocha/06.ts 这个例子。</p></blockquote> <p>如果你的项目是 ts 写的，则一般需要引入 <code>ts-node/register</code> ：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> i ts-node --save-dev
</code></pre></div><p>同时需要在 <code>.mocharc.yml</code>  中增加一个 <code>require</code> 的配置：</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">require</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">'ts-node/register'</span>
</code></pre></div><p>而 <code>package.json</code> 文件中，则可修改为：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test:unit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha 'test/unit/**/*.{ts,tsx}'&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-常见问题"><a href="#_5-常见问题" class="header-anchor">#</a> 5. 常见问题</h2> <h3 id="_5-1-我的项目包含了-window-等怎么测试"><a href="#_5-1-我的项目包含了-window-等怎么测试" class="header-anchor">#</a> 5.1 我的项目包含了 window 等怎么测试？</h3> <p>如果你的代码里面有 <code>window</code> 等代码，还可能需要加入 <a href="https://www.npmjs.com/package/jsdom" target="_blank" rel="noopener noreferrer">jsdom<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="https://www.npmjs.com/package/jsdom-global" target="_blank" rel="noopener noreferrer">jsdom-global<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> i jsdom jsdom-global --save-dev
</code></pre></div><p>同时需要在 <code>.mocharc.yml</code> 中增加一个 <code>require</code> 的配置：</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">require</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">'jsdom-global/register'</span>
</code></pre></div><p>如果是 <code>mocha.opts</code> 文件的话则为：</p> <div class="language- extra-class"><pre class="language-text"><code>--require jsdom-global/register
</code></pre></div><h3 id="_5-2-忽略样式引用"><a href="#_5-2-忽略样式引用" class="header-anchor">#</a> 5.2 忽略样式引用</h3> <p>单测一些组件的时候往往会因为引用了样式导致 mocha 运行失败，需要安装 <a href="https://www.npmjs.com/package/ignore-styles" target="_blank" rel="noopener noreferrer">ignore-styles<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> :</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> i ignore-styles --save-dev
</code></pre></div><p>同时需要在<code>.mocharc.yml</code> 中增加一个 <code>require</code> 的配置：</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">require</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">'ignore-styles'</span>
</code></pre></div><h3 id="_5-3-模拟全局函数"><a href="#_5-3-模拟全局函数" class="header-anchor">#</a> 5.3 模拟全局函数</h3> <p>需要安装 <a href="https://www.npmjs.com/package/sinon" target="_blank" rel="noopener noreferrer">sinon<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> :</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> i sinon --save-dev
</code></pre></div><p>例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> sinon <span class="token keyword">from</span> <span class="token string">'sinon'</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>aegis <span class="token operator">=</span> sinon<span class="token punctuation">.</span><span class="token function">fake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>aegis<span class="token punctuation">.</span>info <span class="token operator">=</span> sinon<span class="token punctuation">.</span><span class="token function">fake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用 sinon 的好处在于可以监听函数的行为，更多 sinon 的使用方法可参考 <a href="https://sinonjs.org/" target="_blank" rel="noopener noreferrer">https://sinonjs.org/<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 。</p> <h3 id="_5-4-解决-webpack-路径别名"><a href="#_5-4-解决-webpack-路径别名" class="header-anchor">#</a> 5.4 解决 webpack 路径别名</h3> <p>需要安装  <a href="https://www.npmjs.com/package/babel-plugin-module-resolver" target="_blank" rel="noopener noreferrer">babel-plugin-module-resolver<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> i babel-plugin-module-resolver --save-dev
</code></pre></div><p>在 <code>.babelrc</code> 中添加配置：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&quot;module-resolver&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;alias&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./test&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/test-automation-training/unit-testing-with-mocha/mocha.html" class="prev">
        Mocha 入门教程
      </a></span> <span class="next"><a href="/test-automation-training/unit-testing-with-mocha/nyc.html">
        代码覆盖率
      </a>
      →
    </span></p></div> </main> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/test-automation-training/assets/js/app.71eef9e6.js" defer></script><script src="/test-automation-training/assets/js/6.83bd01bd.js" defer></script><script src="/test-automation-training/assets/js/3.7625da88.js" defer></script><script src="/test-automation-training/assets/js/17.22baea5e.js" defer></script>
  </body>
</html>
