(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{399:function(t,s,a){"use strict";a.r(s);var e=a(42),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"为项目接入单元测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为项目接入单元测试"}},[t._v("#")]),t._v(" 为项目接入单元测试")]),t._v(" "),a("h2",{attrs:{id:"_1-约定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-约定"}},[t._v("#")]),t._v(" 1. 约定")]),t._v(" "),a("p",[t._v("参考业界通用实践，我们推荐如下约定。")]),t._v(" "),a("h3",{attrs:{id:"_1-1-测试文件放置在-test-unit-目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-测试文件放置在-test-unit-目录"}},[t._v("#")]),t._v(" 1.1 测试文件放置在 "),a("code",[t._v("test/unit")]),t._v(" 目录")]),t._v(" "),a("p",[t._v("对于 Mocha 而言，其默认目录为 "),a("code",[t._v("test")]),t._v("，但我们推荐单元测试的测试文件目录为 "),a("code",[t._v("test/unit")]),t._v(" ，原因包括：")]),t._v(" "),a("ul",[a("li",[t._v("可能会存在一些额外的与测试相关的脚本或者资源等放在 "),a("code",[t._v("test/scripts")]),t._v(" 或 "),a("code",[t._v("test/data")]),t._v(" 中，可使之隔离，更容易处理")]),t._v(" "),a("li",[t._v("可与端对端测试文件目录 "),a("code",[t._v("test/e2e")]),t._v(" 进行区分")])]),t._v(" "),a("h3",{attrs:{id:"_1-2-测试产物都输出到-test-output-目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-测试产物都输出到-test-output-目录"}},[t._v("#")]),t._v(" 1.2 测试产物都输出到 "),a("code",[t._v(".test_output")]),t._v(" 目录")]),t._v(" "),a("p",[t._v("一般测试产物可能包括 Mocha 的测试报告（例如 "),a("code",[t._v("mochawesome")]),t._v("）和覆盖率报告(例如 "),a("code",[t._v("nyc")]),t._v(")等，将它们统一输出到一个文件夹内，方便管理，避免运行之后，在项目中无端增加过多文件夹，也方便设置 "),a("code",[t._v(".gitignore")]),t._v("。")]),t._v(" "),a("p",[t._v("之所以是 "),a("code",[t._v(".test_output")]),t._v("，是因为一些开源社区组件也是这么命名的，例如 "),a("code",[t._v(".nyc_output")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"_1-3-测试文件命名格式使用-xxx-test-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-测试文件命名格式使用-xxx-test-js"}},[t._v("#")]),t._v(" 1.3 测试文件命名格式使用  "),a("code",[t._v("xxx.test.js")])]),t._v(" "),a("p",[t._v("通常测试文件以 "),a("code",[t._v(".test.js")]),t._v(" 和 "),a("code",[t._v(".spec.js")]),t._v(" 结尾，我们推荐前者。")]),t._v(" "),a("h3",{attrs:{id:"_1-4-不推荐全局安装-mocha"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-不推荐全局安装-mocha"}},[t._v("#")]),t._v(" 1.4 不推荐全局安装 mocha")]),t._v(" "),a("p",[t._v("虽然可以全局安装 "),a("code",[t._v("mocha")]),t._v("，但是我们并不推荐，这并不是必要的，原因主要是：")]),t._v(" "),a("ul",[a("li",[t._v("全局安装时，若有多个项目使用不同的 "),a("code",[t._v("mocha")]),t._v(" 版本，则可能会有问题")]),t._v(" "),a("li",[t._v("安装在本地，在 "),a("code",[t._v("package.json")]),t._v(" 的 "),a("code",[t._v("devDependecies")]),t._v(" 中引入，并适当设置 "),a("code",[t._v("scripts")]),t._v(" 命令即可，或者使用 "),a("code",[t._v("npx mocha xxx")]),t._v(" 也能部分情况下代替全局安装的 "),a("code",[t._v("mocha")])])]),t._v(" "),a("h2",{attrs:{id:"_2-快速接入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-快速接入"}},[t._v("#")]),t._v(" 2. 快速接入")]),t._v(" "),a("h3",{attrs:{id:"_2-1-安装依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装依赖"}},[t._v("#")]),t._v(" 2.1 安装依赖")]),t._v(" "),a("p",[t._v("使用 Mocha 做单元测试时，我们建议使用 "),a("a",{attrs:{href:"https://mochajs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("mocha"),a("OutboundLink")],1),t._v(" + "),a("a",{attrs:{href:"https://www.chaijs.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("chai"),a("OutboundLink")],1),t._v(" 这种组合。并且，由于 mocha 升级到 "),a("code",[t._v("v8.x")]),t._v(" 版本之后做了比较大的改动，建议如果是新业务，直接升级到 "),a("code",[t._v("v8.x")]),t._v(" 以上！")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i mocha chai --save-dev\n")])])]),a("p",[t._v("为了更好的查看测试结果，我们使用 "),a("a",{attrs:{href:"https://www.npmjs.com/package/mochawesome",target:"_blank",rel:"noopener noreferrer"}},[t._v("mochawesome"),a("OutboundLink")],1),t._v("  来做测试报告输出:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i mochawesome --save-dev\n")])])]),a("h3",{attrs:{id:"_2-2-配置-mocha"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-配置-mocha"}},[t._v("#")]),t._v(" 2.2 配置 mocha")]),t._v(" "),a("p",[t._v("如果是 mocha "),a("code",[t._v("v8.x")]),t._v(" 及以上版本，则在项目根目录下创建 "),a("code",[t._v(".mocharc.yml")]),t._v(" 文件，参数说明可以参考 "),a("a",{attrs:{href:"https://mochajs.org/#configuring-mocha-nodejs",target:"_blank",rel:"noopener noreferrer"}},[t._v("CONFIGURING MOCHA (NODE.JS)"),a("OutboundLink")],1),t._v(" 。")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reporter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mochawesome'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reporterOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'reportDir=.test_output/mochawesome'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("recursive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),a("p",[t._v("如果是 mocha "),a("code",[t._v("v8.x")]),t._v(" 以下版本，则在 "),a("code",[t._v("test")]),t._v(" 目录下创建 "),a("code",[t._v("test /mocha.opts")]),t._v(" 文件，并配置如下：")]),t._v(" "),a("blockquote",[a("p",[t._v("强烈建议升级 mocha 到 "),a("code",[t._v("v8.x")]),t._v(" 及以上版本。")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--reporter mochawesome\n--reporter-options reportDir=../.test_output/mochawesome\n--recursive\n")])])]),a("h3",{attrs:{id:"_2-3-修改-package-json"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-修改-package-json"}},[t._v("#")]),t._v(" 2.3 修改 package.json")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("package.json")]),t._v(" 文件的测试命令中追加 "),a("code",[t._v("test")]),t._v(" 配置 ，例如")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test:unit"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mocha test/unit"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("如此一来，就可以通过运行下面的命令执行单元测试了：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run test:unit\n")])])]),a("h3",{attrs:{id:"_2-4-修改-gitignore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-修改-gitignore"}},[t._v("#")]),t._v(" 2.4 修改 .gitignore")]),t._v(" "),a("p",[t._v("由于我们将单元测试的测试产物都输出到 "),a("code",[t._v(".test_output")]),t._v(" 目录下，因此需要在 "),a("code",[t._v(".gitignore")]),t._v(" 文件中追加如下配置，避免提交到 git 仓库中 。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(".test_output\n")])])]),a("h3",{attrs:{id:"_2-5-验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-验证"}},[t._v("#")]),t._v(" 2.5. 验证")]),t._v(" "),a("p",[t._v("新增 "),a("code",[t._v("test/unit/tmp.test.js")]),t._v("，内容下：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" expect "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'chai'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("describe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'加法函数的测试'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("it")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1 加 1 应该等于 2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("to"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("be"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("equal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("在项目根目录下，执行 "),a("code",[t._v("npm run test:unit")]),t._v(" 命令，如果输出正常，且在 "),a("code",[t._v(".test_output")]),t._v(" 目录下有输出，则说明配置已完成。")]),t._v(" "),a("p",[a("img",{attrs:{src:"index_files/0c84c031-f10a-4f4b-8385-ba315070662e.jpg",alt:""}}),t._v(" "),a("img",{attrs:{src:"index_files/d15bc4a1-d6b5-4d8d-b540-ed7b10e6e73c.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"_3-es6-项目接入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-es6-项目接入"}},[t._v("#")]),t._v(" 3. ES6 项目接入")]),t._v(" "),a("blockquote",[a("p",[t._v("可以参考 https://github.com/matmanjs/test-automation-training/tree/master/mocha/05.es6 这个例子。")])]),t._v(" "),a("p",[t._v("需要引入 "),a("a",{attrs:{href:"https://babeljs.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("babel"),a("OutboundLink")],1),t._v(" 及相关插件来处理，例如引入 "),a("a",{attrs:{href:"https://www.npmjs.com/package/@babel/preset-env",target:"_blank",rel:"noopener noreferrer"}},[t._v("@babel/preset-env"),a("OutboundLink")],1),t._v(" ：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i @babel/preset-env --save-dev\n")])])]),a("p",[t._v("同时为 "),a("code",[t._v(".babelrc")]),t._v(" 文件增加配置：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"presets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/preset-env"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("最后需要在 "),a("code",[t._v(".mocharc.yml")]),t._v(" 中增加一个 "),a("code",[t._v("require")]),t._v(" 的配置：")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@babel/preset-env'")]),t._v("\n")])])]),a("p",[t._v("但有时候单元测试使用的 babel 配置与项目构建的可能不一样，例如  "),a("a",{attrs:{href:"https://github.com/facebook/create-react-app",target:"_blank",rel:"noopener noreferrer"}},[t._v("create-react-app"),a("OutboundLink")],1),t._v(" 的应用，就不会直接暴露 "),a("code",[t._v(".babelrc")]),t._v(" 出来，此时可以使用 "),a("code",[t._v("BABEL_ENV")]),t._v(" 来处理，可以配置 "),a("code",[t._v(".babelrc")]),t._v(" 为：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"env"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"presets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/preset-env"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("然后测试命令中增加  "),a("code",[t._v("BABEL_ENV=test")]),t._v("，例如  "),a("code",[t._v("cross-env BABEL_ENV=test mocha test/unit")]),t._v(" 。如果在 "),a("code",[t._v("package.json")]),t._v(" 文件中，则可修改为：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test:unit"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cross-env BABEL_ENV=test mocha test/unit"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("注意需要安装下 "),a("a",{attrs:{href:"https://www.npmjs.com/package/cross-env",target:"_blank",rel:"noopener noreferrer"}},[t._v("cross-env"),a("OutboundLink")],1),t._v(" :")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i cross-env --save-dev\n")])])]),a("h2",{attrs:{id:"_4-ts-项目接入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ts-项目接入"}},[t._v("#")]),t._v(" 4. TS 项目接入")]),t._v(" "),a("blockquote",[a("p",[t._v("可以参考 https://github.com/matmanjs/test-automation-training/tree/master/mocha/06.ts 这个例子。")])]),t._v(" "),a("p",[t._v("如果你的项目是 ts 写的，则一般需要引入 "),a("code",[t._v("ts-node/register")]),t._v(" ：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i ts-node --save-dev\n")])])]),a("p",[t._v("同时需要在 "),a("code",[t._v(".mocharc.yml")]),t._v("  中增加一个 "),a("code",[t._v("require")]),t._v(" 的配置：")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ts-node/register'")]),t._v("\n")])])]),a("p",[t._v("而 "),a("code",[t._v("package.json")]),t._v(" 文件中，则可修改为：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test:unit"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"mocha 'test/unit/**/*.{ts,tsx}'\"")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"_5-常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-常见问题"}},[t._v("#")]),t._v(" 5. 常见问题")]),t._v(" "),a("h3",{attrs:{id:"_5-1-我的项目包含了-window-等怎么测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-我的项目包含了-window-等怎么测试"}},[t._v("#")]),t._v(" 5.1 我的项目包含了 window 等怎么测试？")]),t._v(" "),a("p",[t._v("如果你的代码里面有 "),a("code",[t._v("window")]),t._v(" 等代码，还可能需要加入 "),a("a",{attrs:{href:"https://www.npmjs.com/package/jsdom",target:"_blank",rel:"noopener noreferrer"}},[t._v("jsdom"),a("OutboundLink")],1),t._v(" 和 "),a("a",{attrs:{href:"https://www.npmjs.com/package/jsdom-global",target:"_blank",rel:"noopener noreferrer"}},[t._v("jsdom-global"),a("OutboundLink")],1),t._v(" ：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i jsdom jsdom-global --save-dev\n")])])]),a("p",[t._v("同时需要在 "),a("code",[t._v(".mocharc.yml")]),t._v(" 中增加一个 "),a("code",[t._v("require")]),t._v(" 的配置：")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jsdom-global/register'")]),t._v("\n")])])]),a("p",[t._v("如果是 "),a("code",[t._v("mocha.opts")]),t._v(" 文件的话则为：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--require jsdom-global/register\n")])])]),a("h3",{attrs:{id:"_5-2-忽略样式引用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-忽略样式引用"}},[t._v("#")]),t._v(" 5.2 忽略样式引用")]),t._v(" "),a("p",[t._v("单测一些组件的时候往往会因为引用了样式导致 mocha 运行失败，需要安装 "),a("a",{attrs:{href:"https://www.npmjs.com/package/ignore-styles",target:"_blank",rel:"noopener noreferrer"}},[t._v("ignore-styles"),a("OutboundLink")],1),t._v(" :")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i ignore-styles --save-dev\n")])])]),a("p",[t._v("同时需要在"),a("code",[t._v(".mocharc.yml")]),t._v(" 中增加一个 "),a("code",[t._v("require")]),t._v(" 的配置：")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ignore-styles'")]),t._v("\n")])])]),a("h3",{attrs:{id:"_5-3-模拟全局函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-模拟全局函数"}},[t._v("#")]),t._v(" 5.3 模拟全局函数")]),t._v(" "),a("p",[t._v("需要安装 "),a("a",{attrs:{href:"https://www.npmjs.com/package/sinon",target:"_blank",rel:"noopener noreferrer"}},[t._v("sinon"),a("OutboundLink")],1),t._v(" :")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i sinon --save-dev\n")])])]),a("p",[t._v("例如：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sinon "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sinon'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aegis "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sinon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fake")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aegis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("info "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sinon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fake")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("使用 sinon 的好处在于可以监听函数的行为，更多 sinon 的使用方法可参考 "),a("a",{attrs:{href:"https://sinonjs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://sinonjs.org/"),a("OutboundLink")],1),t._v(" 。")]),t._v(" "),a("h3",{attrs:{id:"_5-4-解决-webpack-路径别名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-解决-webpack-路径别名"}},[t._v("#")]),t._v(" 5.4 解决 webpack 路径别名")]),t._v(" "),a("p",[t._v("需要安装  "),a("a",{attrs:{href:"https://www.npmjs.com/package/babel-plugin-module-resolver",target:"_blank",rel:"noopener noreferrer"}},[t._v("babel-plugin-module-resolver"),a("OutboundLink")],1),t._v(" ：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i babel-plugin-module-resolver --save-dev\n")])])]),a("p",[t._v("在 "),a("code",[t._v(".babelrc")]),t._v(" 中添加配置：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"plugins"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"module-resolver"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"root"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./src"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"alias"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./test"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);